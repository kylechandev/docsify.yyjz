# 数据备份与恢复

<font color=gray>备份与还原应用的所有数据</font>

## 这很重要

!> 请务必使用该功能，数据无价，认真对待自己的数据！

## 本地备份

### 应用私有目录（Android）

从 Android10 开始为了更好的保护用户的隐私，系统限制 App 直接访问除`应用私有目录`外的任何文件，所以备份文件只能存放在`App 私有目录`，即`Android/data/data/kylec.me.lightbookkeeping`文件夹下。

!> **请格外注意**<br>App 私有目录下的文件将在`清除 App 数据`或`卸载 App`时同时被删除！<br>若你**自己不愿意**使用云备份，请务必注意妥善保管这些备份文件。

从 Android11 开始手机用户无法直接访问`Android/data`下的文件。对于此现象，你可以参考使用下面的 **授权目录** 方案作为代替。

### 授权目录（Android）

在备份与恢复界面，点击页面列表中的`存放目录`，将会打开系统的目录选择界面，然后你可以选择一个目录（建议新建一个专门的目录给一羽记账）并授权给一羽记账，之后的备份文件就会保存到该目录中了。

?> 保存在授权目录中的文件，会持久的存储在你的设备中，即使清除应用数据或卸载。<br>当你重装一羽记账 App 后，只需重新将该目录授权给一羽记账 App，即可恢复之前的备份数据。

### 应用沙盒目录（iOS）

iOS 系统的运行方式是**沙盒**，也就是每个 App 的运行和存储都在自身独立的一块沙盒空间中。<br>**App 存储的任何文件和数据都将在卸载 App 后清空，请务必妥善保管！**

> 备份文件存放沙盒路径：文件 App -> 我的 iPhone -> 一羽记账 -> Backup

## WebDAV 云备份（推荐🍓） :id=cloud-backup

> 推荐使用国内的 [坚果云网盘](https://www.jianguoyun.com/)

> [**一羽记账&坚果云WebDAV配置教程**](/doc/data-manage/jianguoyun.md) （3步骤，1分钟完成）

将数据备份到支持 WebDAV 协议的云盘，如果之前没有接触过WebDAV备份的，也许会觉得这很麻烦，但是使用WebDAV云盘备份，所有的数据都只经过自己，安全性可谓最高了，只是便捷性略差那么一点。所以，就当是以便捷性换取绝对的安全吧~

将 WebDAV  网盘链接到一羽记账 App，需要输入：

- **WebDAV Url**
- **授权账户**
- **授权密码**

!> 输入授权密码时，请不要输入坚果云的账号密码。<br>请输入在 [**坚果云**](http://help.jianguoyun.com/?p=2064) 中为一羽记账创建的独立的 **应用密码**。 <br><br><font color=gray size=2>如果你使用的网盘不用单独创建应用，那么可以尝试直接输入网盘的账号密码。</font>

### X-关于自建WebDAV无法连接可能的解决办法

> **IIS** 搭建，尝试在IIS里将`windows用户身份验证`更换成`基本身份验证` - <font color=gray size=2>感谢群内小伙伴`L`的分享</font>

> **nas** 搭建，尝试使用`http`代替`https` - <font color=gray size=2>感谢酷安小伙伴`lovest`和`一枕清辞`的分享</font>

> **Nginx** 搭建，尝试禁用Nginx的HTTP2或仅使用HTTP1.1 - <font color=gray size=2>感谢酷安小伙伴`来去如风`的分享</font>

> 80/443端口无法链接，尝试使用非80/443的端口 - <font color=gray size=2>感谢`海云海量-Mr.谷`的分享</font>

## iCloud 云备份（iOS）

备份文件到 iCloud 云盘中存储。<font color=orange>（Pro 会员功能）</font>

## 备份文件分享

在本地备份文件列表中，点击最右侧的分享按钮，即可跳转分享。

> 分享仅适用于**本地备份文件**。<br>
> 因为 App 私有目录下的备份文件存储在系统文件管理器中，可能获取不是很方便，分享备份文件可以帮助大家更方便的拿到本地备份文件。

## 恢复备份后不显示数据？

可能的情况有：

1. **「未登录对应账号」**，登录状态下保存的数据需要先登录对应的账号后才能看见；

2. **「未切换账本」**，尝试在首页切换一下展示账本（如果只有一个，可重复选择一次）；
   
   Android版本:
   
   <img title="" src="https://z1.ax1x.com/2023/11/25/piwjgBV.jpg" alt="首页账本android" width="382">
   
   iOS版本：
   
   <img title="" src="https://z1.ax1x.com/2023/11/25/piwjcn0.png" alt="首页账本ios" width="444">

3. **「未正确备份数据」**，备份文件中并没有任何数据，就是一个空的，此时恢复备份肯定也显示不出来数据的。

!> **请勿在低版本恢复从高版本备份的文件！**<br>因为数据库升级，低版本无法识别高版本的备份，会导致 App 闪退。

## 重要申明

**一羽记账非常重视数据的保存**，已在「登录注册界面」「个人中心界面」「备份与恢复操作过程」都警示了备份的重要性，并详细解释了各类备份的形式。如果再因`个人操作失误`或`不备份`等导致的数据丢失问题，一羽记账可不负责了哦！

看到这里，十分感谢你的理解！

最后，建议你务必使用 [云备份](#cloud-backup)，**数据无价！**

## 了解更多

?> 一羽记账Pro功能：[数据云同步](/doc/pro/data-sync.md)